webpackJsonp([32],{nlDa:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("gRE1"),s=n.n(o),a=n("mvHQ"),i=n.n(a),r=n("Dd8w"),u=n.n(r),l=n("NYxO"),c={labelCol:{span:24},wrapperCol:{span:24}},p={name:"PaymentAdd",props:{paymentAddVisiable:{default:!1}},computed:u()({},Object(l.c)({currentUser:function(t){return t.account.user}}),{show:{get:function(){return this.paymentAddVisiable},set:function(){}}}),mounted:function(){this.getPropertyList(),this.getHousesList()},data:function(){return{formItemLayout:c,form:this.$form.createForm(this),loading:!1,fileList:[],previewVisible:!1,previewImage:"",housesData:null,consumptionInfo:[],housesId:null,propertyList:[],housesList:[],energyNow:0,waterNow:0,energyUsed:0,waterUsed:0,electricityBill:0,waterBill:0}},methods:{energyChange:function(){var t=this,e=0;this.propertyList.forEach(function(t){1===t.id&&(e=t.price)}),0===this.consumptionInfo.length?this.electricityBill=this.electricityCalculation(this.energyNow,e):this.consumptionInfo.forEach(function(n){if(1===n.type){var o=t.energyNow-n.dose;t.electricityBill=t.electricityCalculation(o,e)}})},electricityCalculation:function(t,e){var n=0,o=0,s=0;return t>400?(s=((t-400)*(e+.3)).toFixed(2),n=(400*e).toFixed(2)):t>200?(o=((t-200)*(e+.05)).toFixed(2),n=(200*e).toFixed(2)):t<=200&&(n=(t*e).toFixed(2)),Number(n)+Number(o)+Number(s)},waterChange:function(){var t=this,e=0;this.propertyList.forEach(function(t){2===t.id&&(e=t.price)}),0===this.consumptionInfo.length?this.waterBill=(this.waterNow*e).toFixed(2):this.consumptionInfo.forEach(function(n){2===n.type&&(t.waterBill=((t.waterNow-n.dose)*e).toFixed(2))})},housesChange:function(t,e){var n=this;this.housesList.forEach(function(e){e.id===t&&(n.housesData=e)}),this.housesConsumption(t),t&&(this.housesId=t)},housesConsumption:function(t){var e=this;this.$get("/cos/houses-info/housesConsumption",{housesId:t}).then(function(t){e.consumptionInfo=t.data.data})},filterOption:function(t,e){return e.componentOptions.address[0].text.toLowerCase().indexOf(t.toLowerCase())>=0},getPropertyList:function(){var t=this;this.$get("/cos/property-item/list").then(function(e){t.propertyList=e.data.data})},getHousesList:function(){var t=this;this.$get("/cos/houses-info/list").then(function(e){t.housesList=e.data.data})},reset:function(){this.loading=!1,this.form.resetFields()},onClose:function(){this.reset(),this.$emit("close")},handleSubmit:function(){var t=this;this.$get("/cos/houses-info/housesConsumptionMonth",{housesId:this.housesId}).then(function(e){if(0!==e.data.data.length)t.$message.warning("该房屋本月已进行清算！");else{var n=[],o=[];t.propertyList.forEach(function(e){var s=0,a=e.price;1!==e.id&&2!==e.id||(o.push({housesId:t.housesId,type:e.id,year:(new Date).getFullYear(),month:Number((new Date).getMonth())+1,dose:1===e.id?t.energyNow:t.waterNow}),0===t.consumptionInfo.length?s=1===e.id?t.energyNow:t.waterNow:t.consumptionInfo.forEach(function(n){e.id===n.type&&1===e.id&&(s=Number(t.energyNow)-Number(n.dose)),e.id===n.type&&2===e.id&&(s=Number(t.waterNow)-Number(n.dose))}),1===e.id&&(a=t.electricityBill),2===e.id&&(a=t.waterBill)),3===e.id&&(a=e.price*t.housesData.usageArea),n.push({housesId:t.housesId,type:e.id,year:(new Date).getFullYear(),month:Number((new Date).getMonth())+1,dosage:s,price:a})}),t.$post("/cos/payment-manage/addPaymentManage",{paymentManageStr:i()(s()(n))}).then(function(e){t.$post("/cos/consumption-info/addConsumption",{consumptionInfoStr:i()(s()(o))}).then(function(e){t.electricityBill=0,t.waterBill=0,t.$emit("success")}).catch(function(){t.loading=!1})}).catch(function(){t.loading=!1})}})}}},_={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-modal",{attrs:{title:"抄表入库",width:800},on:{cancel:t.onClose},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[n("template",{slot:"footer"},[n("a-button",{key:"back",on:{click:t.onClose}},[t._v("\n      取消\n    ")]),t._v(" "),n("a-button",{key:"submit",attrs:{type:"primary",loading:t.loading},on:{click:t.handleSubmit}},[t._v("\n      提交\n    ")])],1),t._v(" "),n("div",[n("a-row",{attrs:{gutter:20}},[n("a-col",{attrs:{span:14}},[n("a-form-item",t._b({attrs:{label:"所属房屋"}},"a-form-item",t.formItemLayout,!1),[n("a-select",{staticStyle:{width:"100%"},attrs:{showSearch:"",optionFilterProp:"children"},on:{change:t.housesChange},model:{value:t.housesId,callback:function(e){t.housesId=e},expression:"housesId"}},t._l(t.housesList,function(e,o){return n("a-select-option",{key:o,attrs:{value:e.id}},[t._v(t._s(e.address))])}))],1)],1),t._v(" "),null!==t.housesData?n("a-col",{attrs:{span:24}},[n("a-row",{attrs:{gutter:15}},[n("a-col",{attrs:{span:8}},[n("b",[t._v("本月电表指数（度）")]),t._v(" "),t._l(t.consumptionInfo,function(e,o){return 1==e.type?n("a-input-number",{key:o,staticStyle:{width:"100%"},attrs:{min:e.dose},on:{blur:t.energyChange},model:{value:t.energyNow,callback:function(e){t.energyNow=e},expression:"energyNow"}}):t._e()}),t._v(" "),0===t.consumptionInfo.length?n("a-input-number",{staticStyle:{width:"100%"},attrs:{min:.1},on:{blur:t.energyChange},model:{value:t.energyNow,callback:function(e){t.energyNow=e},expression:"energyNow"}}):t._e()],2),t._v(" "),n("a-col",{attrs:{span:8}},[n("b",[t._v("本月水表指数（吨）")]),t._v(" "),t._l(t.consumptionInfo,function(e,o){return 2==e.type?n("a-input-number",{key:o,staticStyle:{width:"100%"},attrs:{min:e.dose},on:{blur:t.waterChange},model:{value:t.waterNow,callback:function(e){t.waterNow=e},expression:"waterNow"}}):t._e()}),t._v(" "),0===t.consumptionInfo.length?n("a-input-number",{staticStyle:{width:"100%"},attrs:{min:.1},on:{blur:t.waterChange},model:{value:t.waterNow,callback:function(e){t.waterNow=e},expression:"waterNow"}}):t._e()],2)],1),t._v(" "),n("br"),t._v(" "),n("a-row",[n("a-col",{staticStyle:{"margin-bottom":"15px"}},[n("span",{staticStyle:{"font-size":"15px","font-weight":"650",color:"#000c17"}},[t._v("房屋信息")])]),t._v(" "),n("a-col",{attrs:{span:8}},[n("b",[t._v("房间号：")]),t._v("\n            "+t._s(t.housesData.number)+" 室\n          ")]),t._v(" "),n("a-col",{attrs:{span:8}},[n("b",[t._v("房屋地址：")]),t._v(" "),n("a-tooltip",[n("template",{slot:"title"},[t._v("\n                "+t._s(t.housesData.address)+"\n              ")]),t._v("\n              "+t._s(t.housesData.address.slice(0,10))+" ...\n            ")],2)],1),t._v(" "),n("a-col",{attrs:{span:8}},[n("b",[t._v("楼层：")]),t._v("\n            "+t._s(t.housesData.floor)+" 层\n          ")])],1),t._v(" "),n("br"),t._v(" "),n("a-row",[n("a-col",{attrs:{span:8}},[n("b",[t._v("使用面积：")]),t._v("\n            "+t._s(t.housesData.usageArea)+" ㎡\n          ")]),t._v(" "),n("a-col",{attrs:{span:8}},[n("b",[t._v("建筑面积：")]),t._v("\n            "+t._s(t.housesData.surfaceArea)+" ㎡\n          ")]),t._v(" "),n("a-col",{attrs:{span:8}},[n("b",[t._v("房屋类型：")]),t._v(" "),1==t.housesData.nature?n("span",[t._v("住宅楼房")]):t._e(),t._v(" "),2==t.housesData.nature?n("span",[t._v("社区用处")]):t._e()])],1),t._v(" "),n("br"),t._v(" "),n("a-row",[n("a-col",{attrs:{span:8}},[n("b",[t._v("间 数：")]),t._v("\n            "+t._s(t.housesData.rooms)+" 间\n          ")]),t._v(" "),n("a-col",{attrs:{span:8}},[n("b",[t._v("购房人：")]),t._v("\n            "+t._s(t.housesData.buyer)+"\n          ")])],1),t._v(" "),n("br"),t._v(" "),n("br")],1):t._e(),t._v(" "),n("a-col",{attrs:{span:24}},t._l(t.propertyList,function(e,o){return n("a-row",{key:o},[n("a-col",{staticStyle:{"margin-bottom":"15px"}},[n("span",{staticStyle:{"font-size":"15px","font-weight":"650",color:"#000c17"}},[t._v("\n            "+t._s(e.name)+" -\n            "),1==e.type?n("span",[t._v("统一交付")]):t._e(),t._v(" "),2==e.type?n("span",[t._v("\n              按量计算\n              "),1==e.id?n("span",[n("a-tooltip",[n("template",{slot:"title"},[n("p",[t._v("第一档电量：每户每月0~200度 电费不做调整")]),t._v(" "),n("p",[t._v("第二档电量：每户每月201~400度 电价每度加0.05")]),t._v(" "),n("p",[t._v("第三档电量：每户每月400度以上 电价每度加0.3")])]),t._v(" "),n("a-icon",{attrs:{type:"question"}})],2)],1):t._e()]):t._e()])]),t._v(" "),n("a-col",{attrs:{span:8}},[n("b",[t._v("价 格：")]),t._v(" "),1==e.type?n("span",[t._v(t._s(e.price)+" 元")]):t._e(),t._v(" "),2==e.type?n("span",[t._v(t._s(e.price)+" 元/ "+t._s(e.unit))]):t._e()]),t._v(" "),t._l(t.consumptionInfo,function(o,s){return o.type==e.id&&1==e.id?n("a-col",{key:s,attrs:{span:8}},[n("b",[t._v("上月用电：")]),t._v("\n            "+t._s(o.dose)+" "+t._s(e.unit)+"\n          ")]):t._e()}),t._v(" "),1==e.id&&0===t.consumptionInfo.length&&null!==t.housesData?n("a-col",{attrs:{span:8}},[n("b",[t._v("上月用电：")]),t._v(" - - ")]):t._e(),t._v(" "),1==e.id&&null!==t.housesData?n("a-col",{attrs:{span:8}},[n("b",[t._v("本月电费：")]),t._v(t._s(t.electricityBill)+" 元")]):t._e(),t._v(" "),3==e.id&&null!==t.housesData?n("a-col",{attrs:{span:8}},[n("b",[t._v("物业费用：")]),t._v("\n            "+t._s((t.housesData.usageArea*e.price).toFixed(2))+" 元\n          ")]):t._e(),t._v(" "),t._l(t.consumptionInfo,function(o,s){return o.type==e.id&&2==e.id?n("a-col",{key:s,attrs:{span:8}},[n("b",[t._v("上月用水：")]),t._v("\n            "+t._s(o.dose)+" "+t._s(e.unit)+"\n          ")]):t._e()}),t._v(" "),2==e.id&&0===t.consumptionInfo.length&&null!==t.housesData?n("a-col",{attrs:{span:8}},[n("b",[t._v("上月用水：")]),t._v(" - - ")]):t._e(),t._v(" "),2==e.id&&null!==t.housesData?n("a-col",{attrs:{span:8}},[n("b",[t._v("本月水费：")]),t._v(t._s(t.waterBill)+" 元")]):t._e(),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("br")],2)}))],1)],1)],2)},staticRenderFns:[]},h=n("VU/8")(p,_,!1,function(t){n("udUT")},"data-v-d9cbb7d0",null);e.default=h.exports},udUT:function(t,e){}});