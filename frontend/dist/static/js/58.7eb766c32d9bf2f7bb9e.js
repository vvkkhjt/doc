webpackJsonp([58],{Im6d:function(t,e){},iJAC:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=s("gRE1"),n=s.n(o),a=s("mvHQ"),i=s.n(a),r=s("Dd8w"),c=s.n(r),u=s("NYxO"),l=s("PJh5"),h=s.n(l),p={labelCol:{span:24},wrapperCol:{span:24}},_={name:"PaymentAddNew",props:{paymentAddVisiable:{default:!1}},computed:c()({},Object(u.c)({currentUser:function(t){return t.account.user}}),{show:{get:function(){return this.paymentAddVisiable},set:function(){}}}),mounted:function(){this.getPropertyList(),this.getHousesList()},data:function(){return{formItemLayout:p,form:this.$form.createForm(this),loading:!1,fileList:[],previewVisible:!1,previewImage:"",housesData:null,consumptionInfo:[],housesId:null,propertyList:[],housesList:[],energyNow:0,waterNow:0,energyUsed:0,waterUsed:0,electricityBill:0,waterBill:0,checkMonth:null}},methods:{energyChange:function(){var t=this,e=0;this.propertyList.forEach(function(t){1===t.id&&(e=t.price)}),0===this.consumptionInfo.length?this.electricityBill=this.electricityCalculation(this.energyNow,e):this.consumptionInfo.forEach(function(s){if(1===s.type){var o=t.energyNow-s.dose;t.electricityBill=t.electricityCalculation(o,e)}})},electricityCalculation:function(t,e){var s=0,o=0,n=0;return t>400?(n=((t-400)*(e+.3)).toFixed(2),s=(400*e).toFixed(2)):t>200?(o=((t-200)*(e+.05)).toFixed(2),s=(200*e).toFixed(2)):t<=200&&(s=(t*e).toFixed(2)),Number(s)+Number(o)+Number(n)},waterChange:function(){var t=this,e=0;this.propertyList.forEach(function(t){2===t.id&&(e=t.price)}),0===this.consumptionInfo.length?this.waterBill=(this.waterNow*e).toFixed(2):this.consumptionInfo.forEach(function(s){2===s.type&&(t.waterBill=((t.waterNow-s.dose)*e).toFixed(2))})},housesChange:function(t,e){var s=this;this.housesList.forEach(function(e){e.id===t&&(s.housesData=e)}),this.housesConsumption(t),t&&(this.housesId=t)},housesConsumption:function(t){var e=this;this.$get("/cos/houses-info/housesConsumption",{housesId:t}).then(function(t){e.consumptionInfo=t.data.data})},filterOption:function(t,e){return e.componentOptions.address[0].text.toLowerCase().indexOf(t.toLowerCase())>=0},getPropertyList:function(){var t=this;this.$get("/cos/property-item/list").then(function(e){t.propertyList=e.data.data})},getHousesList:function(){var t=this;this.$get("/cos/houses-info/list").then(function(e){t.housesList=e.data.data})},reset:function(){this.loading=!1,this.form.resetFields()},onClose:function(){this.reset(),this.$emit("close")},handleSubmit:function(){var t=this;return this.housesId?this.checkMonth?void this.$get("/cos/houses-info/housesConsumptionCheck",{housesId:this.housesId,date:h()(this.checkMonth).format("YYYY-MM-01")}).then(function(e){if(0!==e.data.data.length)t.$message.warning("该房屋本月已进行清算！");else{var s=[],o=[];t.propertyList.forEach(function(e){var n=0,a=e.price;1!==e.id&&2!==e.id||(o.push({housesId:t.housesId,type:e.id,year:(new Date).getFullYear(),month:Number((new Date).getMonth())+1,dose:1===e.id?t.energyNow:t.waterNow}),0===t.consumptionInfo.length?n=1===e.id?t.energyNow:t.waterNow:t.consumptionInfo.forEach(function(s){e.id===s.type&&1===e.id&&(n=Number(t.energyNow)-Number(s.dose)),e.id===s.type&&2===e.id&&(n=Number(t.waterNow)-Number(s.dose))}),1===e.id&&(a=t.electricityBill),2===e.id&&(a=t.waterBill)),3===e.id&&(a=e.price*t.housesData.usageArea),s.push({housesId:t.housesId,type:e.id,year:h()(t.checkMonth).format("YYYY"),month:h()(t.checkMonth).format("MM"),dosage:n,price:a})}),t.$post("/cos/payment-manage/addPaymentManage",{paymentManageStr:i()(n()(s))}).then(function(e){t.$post("/cos/consumption-info/addConsumption",{consumptionInfoStr:i()(n()(o))}).then(function(e){t.electricityBill=0,t.waterBill=0,t.$emit("success")}).catch(function(){t.loading=!1})}).catch(function(){t.loading=!1})}}):(this.$message.warning("请选择清算日期！"),!1):(this.$message.warning("请选择房屋！"),!1)}}},d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("a-modal",{attrs:{title:"抄表入库",width:800},on:{cancel:t.onClose},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[s("template",{slot:"footer"},[s("a-button",{key:"back",on:{click:t.onClose}},[t._v("\n      取消\n    ")]),t._v(" "),s("a-button",{key:"submit",attrs:{type:"primary",loading:t.loading},on:{click:t.handleSubmit}},[t._v("\n      提交\n    ")])],1),t._v(" "),s("div",[s("a-row",{attrs:{gutter:20}},[s("a-col",{attrs:{span:14}},[s("a-form-item",t._b({attrs:{label:"所属房屋"}},"a-form-item",t.formItemLayout,!1),[s("a-select",{staticStyle:{width:"100%"},attrs:{showSearch:"",optionFilterProp:"children"},on:{change:t.housesChange},model:{value:t.housesId,callback:function(e){t.housesId=e},expression:"housesId"}},t._l(t.housesList,function(e,o){return s("a-select-option",{key:o,attrs:{value:e.id}},[t._v(t._s(e.address))])}))],1)],1),t._v(" "),s("a-col",{attrs:{span:8}},[s("a-form-item",t._b({attrs:{label:"缴费月度"}},"a-form-item",t.formItemLayout,!1),[s("a-month-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"Select month"},model:{value:t.checkMonth,callback:function(e){t.checkMonth=e},expression:"checkMonth"}},[s("a-icon",{attrs:{slot:"suffixIcon",type:"smile"},slot:"suffixIcon"})],1)],1)],1),t._v(" "),null!==t.housesData?s("a-col",{attrs:{span:24}},[s("a-row",[s("a-col",{staticStyle:{"margin-bottom":"15px"}},[s("span",{staticStyle:{"font-size":"15px","font-weight":"650",color:"#000c17"}},[t._v("房屋信息")])]),t._v(" "),s("a-col",{attrs:{span:8}},[s("b",[t._v("房间号：")]),t._v("\n            "+t._s(t.housesData.number)+" 室\n          ")]),t._v(" "),s("a-col",{attrs:{span:8}},[s("b",[t._v("房屋地址：")]),t._v(" "),s("a-tooltip",[s("template",{slot:"title"},[t._v("\n                "+t._s(t.housesData.address)+"\n              ")]),t._v("\n              "+t._s(t.housesData.address.slice(0,10))+" ...\n            ")],2)],1),t._v(" "),s("a-col",{attrs:{span:8}},[s("b",[t._v("楼层：")]),t._v("\n            "+t._s(t.housesData.floor)+" 层\n          ")])],1),t._v(" "),s("br"),t._v(" "),s("a-row",[s("a-col",{attrs:{span:8}},[s("b",[t._v("使用面积：")]),t._v("\n            "+t._s(t.housesData.usageArea)+" ㎡\n          ")]),t._v(" "),s("a-col",{attrs:{span:8}},[s("b",[t._v("建筑面积：")]),t._v("\n            "+t._s(t.housesData.surfaceArea)+" ㎡\n          ")]),t._v(" "),s("a-col",{attrs:{span:8}},[s("b",[t._v("房屋类型：")]),t._v(" "),1==t.housesData.nature?s("span",[t._v("住宅楼房")]):t._e(),t._v(" "),2==t.housesData.nature?s("span",[t._v("社区用处")]):t._e()])],1),t._v(" "),s("br"),t._v(" "),s("a-row",[s("a-col",{attrs:{span:8}},[s("b",[t._v("间 数：")]),t._v("\n            "+t._s(t.housesData.rooms)+" 间\n          ")]),t._v(" "),s("a-col",{attrs:{span:8}},[s("b",[t._v("购房人：")]),t._v("\n            "+t._s(t.housesData.buyer)+"\n          ")])],1),t._v(" "),s("br"),t._v(" "),s("br")],1):t._e(),t._v(" "),s("a-col",{attrs:{span:24}},t._l(t.propertyList,function(e,o){return s("a-row",{key:o},[s("a-col",{staticStyle:{"margin-bottom":"15px"}},[s("span",{staticStyle:{"font-size":"15px","font-weight":"650",color:"#000c17"}},[t._v("\n            "+t._s(e.name)+" -\n            "),1==e.type?s("span",[t._v("统一交付")]):t._e(),t._v(" "),2==e.type?s("span",[t._v("\n              按量计算\n              "),1==e.id?s("span",[s("a-tooltip",[s("template",{slot:"title"},[s("p",[t._v("第一档电量：每户每月0~200度 电费不做调整")]),t._v(" "),s("p",[t._v("第二档电量：每户每月201~400度 电价每度加0.05")]),t._v(" "),s("p",[t._v("第三档电量：每户每月400度以上 电价每度加0.3")])]),t._v(" "),s("a-icon",{attrs:{type:"question"}})],2)],1):t._e()]):t._e()])]),t._v(" "),s("a-col",{attrs:{span:8}},[s("b",[t._v("价 格：")]),t._v(" "),1==e.type?s("span",[t._v(t._s(e.price)+" 元")]):t._e(),t._v(" "),2==e.type?s("span",[t._v(t._s(e.price)+" 元/ "+t._s(e.unit))]):t._e()]),t._v(" "),t._l(t.consumptionInfo,function(o,n){return o.type==e.id&&1==e.id?s("a-col",{key:n,attrs:{span:8}},[s("b",[t._v("上月用电：")]),t._v("\n            "+t._s(o.dose)+" "+t._s(e.unit)+"\n          ")]):t._e()}),t._v(" "),1==e.id&&0===t.consumptionInfo.length&&null!==t.housesData?s("a-col",{attrs:{span:8}},[s("b",[t._v("上月用电：")]),t._v(" - - ")]):t._e(),t._v(" "),1==e.id&&null!==t.housesData?s("a-col",{attrs:{span:8}},[s("b",[t._v("本月电费：")]),t._v(t._s(t.electricityBill)+" 元")]):t._e(),t._v(" "),3==e.id&&null!==t.housesData?s("a-col",{attrs:{span:8}},[s("b",[t._v("物业费用：")]),t._v("\n            "+t._s((t.housesData.usageArea*e.price).toFixed(2))+" 元\n          ")]):t._e(),t._v(" "),t._l(t.consumptionInfo,function(o,n){return o.type==e.id&&2==e.id?s("a-col",{key:n,attrs:{span:8}},[s("b",[t._v("上月用水：")]),t._v("\n            "+t._s(o.dose)+" "+t._s(e.unit)+"\n          ")]):t._e()}),t._v(" "),2==e.id&&0===t.consumptionInfo.length&&null!==t.housesData?s("a-col",{attrs:{span:8}},[s("b",[t._v("上月用水：")]),t._v(" - - ")]):t._e(),t._v(" "),2==e.id&&null!==t.housesData?s("a-col",{attrs:{span:8}},[s("b",[t._v("本月水费：")]),t._v(t._s(t.waterBill)+" 元")]):t._e(),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("br")],2)}))],1)],1)],2)},staticRenderFns:[]},v=s("VU/8")(_,d,!1,function(t){s("Im6d")},"data-v-558717e2",null);e.default=v.exports}});